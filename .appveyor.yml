image: Visual Studio 2017
configuration:
  - Debug
  - Release
platform:
  - x64
  - x86
environment:
  matrix:
#    - generator: mingw-w64
    - generator: vs2017

matrix:
  fast_finish: true

for:
  - matrix:
      only:
        - generator: vs2017
    install:
      - git submodule update --init
      - cinst nasm nsis
      - appveyor DownloadFile https://download.tsi.telecom-paristech.fr/gpac/gpac_extra_libs.zip -FileName extra_libs.zip
      - unzip extra_libs.zip > nul
      - cd gpac_extra_libs
      - unzip a52dec.zip > nul
      - unzip dektec_dtapi_201505.zip > nul
      - unzip faad2.zip > nul
      - unzip freetype.zip > nul
      - unzip js.zip > nul
      - unzip libjpg.zip > nul
      - unzip libmad.zip > nul
      - unzip libogg.zip > nul
      - unzip libpng.zip > nul
      - unzip libtheora.zip > nul
      - unzip libvorbis.zip > nul
      - unzip OpenJPEG.zip > nul
      - unzip opensvc.zip > nul
      - unzip PlatinumSDK.zip > nul
      - unzip SDL_iOS.zip > nul
      - unzip xvidcore.zip > nul
      - unzip zlib.zip > nul
      - cd ..
      - set PATH=%PATH%;%APPVEYOR_BUILD_FOLDER%;C:\Program Files\NASM
    before_build:
      - ps: msbuild gpac_extra_libs\build\msvc\BuildAll_vc10.sln /t:Build  /p:Configuration=Release /p:Platform=$(if ($env:PLATFORM -eq "x64") {Write-Output "x64"} else {Write-Output "Win32"}) /p:PlatformToolset=v140 /m /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
      - dir gpac_extra_libs\lib\win32\release
      - gpac_extra_libs\CopyLibs2Public.bat %PLATFORM%
      - version.bat
    build:
      project: build/msvc14/gpac.sln
      parallel: true
    after_build:
      - gpac_public\generate_installer.bat







#artifacts:
#  - path: bin\
#    name: $(APPVEYOR_PROJECT_NAME)
#  - path: bin\
#    name: $(APPVEYOR_PROJECT_NAME)

#deploy:
#  - provider: GitHub
#    artifact: $(APPVEYOR_PROJECT_NAME)
#    auth_token:
#      secure: 'sf0pQXlPI+X6LoAR8QUJB74jjzNxcLGOXI3H0nbxJq8llvGPG/TAUd87hq5iHZXo'
#    prerelease: true
#    on:
#      appveyor_repo_tag: true
