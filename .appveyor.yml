image: Visual Studio 2017
configuration:
  - Debug
  - Release
platform:
  - x64
  - x86
environment:
  matrix:
#    - generator: mingw-w64
    - generator: vs2017

matrix:
  fast_finish: true

for:
  - matrix:
      only:
        - generator: vs2017
    install:
      - git submodule update --init
      - cinst nasm
      - cinst nsis -pre
      - appveyor DownloadFile https://download.tsi.telecom-paristech.fr/gpac/gpac_extra_libs.zip -FileName extra_libs.zip
      - unzip extra_libs.zip
      - cd gpac_extra_libs
      - unzip a52dec.zip
      - unzip dektec_dtapi_201505.zip
      - unzip faad2.zip
      - unzip freetype.zip
      - unzip js.zip
      - unzip libjpg.zip
      - unzip libmad.zip
      - unzip libogg.zip
      - unzip libpng.zip
      - unzip libtheora.zip
      - unzip libvorbis.zip
      - unzip OpenJPEG.zip
      - unzip opensvc.zip
      - unzip PlatinumSDK.zip
      - unzip SDL_iOS.zip
      - unzip xvidcore.zip
      - unzip zlib.zip

      - cd ..
      - set PATH=%PATH%;%APPVEYOR_BUILD_FOLDER%
    before_build:
      - msbuild gpac_extra_libs\build\msvc\BuildAll_vc10.sln /t:Build  /p:Configuration=Release
      - dir gpac_extra_libs\lib\win32\release
      - gpac_extra_libs\CopyLibs2Public.bat %PLATFORM%
      - version.bat
    build:
      project: build/msvc14/gpac.sln
      parallel: true
    after_build:
      - gpac_public\generate_installer.bat







#artifacts:
#  - path: bin\
#    name: $(APPVEYOR_PROJECT_NAME)
#  - path: bin\
#    name: $(APPVEYOR_PROJECT_NAME)

#deploy:
#  - provider: GitHub
#    artifact: $(APPVEYOR_PROJECT_NAME)
#    auth_token:
#      secure: 'sf0pQXlPI+X6LoAR8QUJB74jjzNxcLGOXI3H0nbxJq8llvGPG/TAUd87hq5iHZXo'
#    prerelease: true
#    on:
#      appveyor_repo_tag: true
